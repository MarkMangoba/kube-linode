#!/usr/bin/expect
set id [lindex $argv 0]
set user [lindex $argv 1]
set ssh_key [lindex $argv 2]

spawn ssh -t $user@lish-singapore.linode.com $id

expect "ttyS0:~#"
send "mkdir -p ~/.ssh\r"
send "touch ~/.ssh/authorized_keys\r"
send "echo \"$ssh_key\" >> ~/.ssh/authorized_keys\r"
send "/etc/init.d/ssh start\r"
expect "root@ttyS0:~#"
send "\x01"
send "d"
expect "lish]#"
send "exit\r"
